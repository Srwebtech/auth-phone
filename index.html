<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
</head>
<body>
  <h2>Phone Login (India)</h2>

  <input id="phone" placeholder="Enter 10-digit mobile number" />
  <button onclick="sendOTP()">Send OTP</button>

  <div id="recaptcha-container"></div>

  <br/><br/>

  <input id="otp" placeholder="Enter OTP" />
  <button onclick="verifyOTP()">Verify OTP</button>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCJLFXsc7As3vzTI4WhVNvH84TTwAKMPGs",
      authDomain: "jewellery-app-81948.firebaseapp.com",
      projectId: "jewellery-app-81948",
      messagingSenderId: "530023953234",
      appId: "1:530023953234:web:fce103de6576cf7f99c08b",
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();

    window.sendOTP = function () {
      let phoneInput = document.getElementById("phone").value.trim();

      // Validate Indian number length
      if (!/^\d{10}$/.test(phoneInput)) {
        alert("Enter a valid 10-digit mobile number");
        return;
      }

      // Prepend +91 automatically
      const phone = "+91" + phoneInput;

      const recaptcha = new firebase.auth.RecaptchaVerifier("recaptcha-container", {
        size: "invisible"
      });

      auth.signInWithPhoneNumber(phone, recaptcha)
        .then((result) => {
          window.confirmationResult = result;
          alert("OTP Sent to " + phone);
        })
        .catch((err) => alert(err));
    };

    window.verifyOTP = function () {
      const code = document.getElementById("otp").value;
      window.confirmationResult.confirm(code)
        .then((res) => {
          alert("SUCCESS: " + res.user.phoneNumber);
          // Send user data back to React Native
          window.ReactNativeWebView.postMessage(JSON.stringify({ uid: res.user.uid, phone: res.user.phoneNumber }));
        })
        .catch((err) => alert(err));
    };
  </script>
</body>
</html>
